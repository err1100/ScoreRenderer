<html>
	<head>
	    <link rel="stylesheet" type="text/css" href="Fonts/Gonville/stylesheet.css">
	    <script src="https://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.1.min.js"></script>
	    <script type="text/javascript" src="Fonts/Gonville/Gonville.js"></script>
	    <script type="text/javascript" src="Renderer.js"></script>
	    <script type="text/javascript" src="BezierTools.js"></script>
	    <script type="text/javascript" src="LineContext.js"></script>
		<script type="text/javascript" src="ScoreRenderer.js"></script>
		<script type="text/javascript" src="DisplayInformation.js"></script>
		<script type="text/javascript" src="BoundingBox.js"></script>
		<script type="text/javascript" src="GlyphLeaf.js"></script>
		<script type="text/javascript" src="GlyphFactory.js"></script>
		<script type="text/javascript" src="GlyphComposite.js"></script>
		<script type="text/javascript" src="ScoreDisplay.js"></script>
		<script type="text/javascript" src="TouchManager.js"></script>
		<script type="text/javascript" src="ScoreNavigator.js"></script>
		<script type="text/javascript" src="ScoreCursor.js"></script>
		<script type="text/javascript" src="BreadthFirstCompositeIterator.js"></script>
		<script type="text/javascript" src="DepthFirstCompositeIterator.js"></script>
		<script type="text/javascript" src="SingleIterator.js"></script>
		<script type="text/javascript" src="ScoreComposite.js"></script>
		<script type="text/javascript" src="ScoreLeaf.js"></script>
		<script type="text/javascript" src="Score.js"></script>
	    <script type="text/javascript" src="Part.js"></script>
	    <script type="text/javascript" src="Voice.js"></script>
	    <script type="text/javascript" src="VoiceGroup.js"></script>
	    <script type="text/javascript" src="Text.js"></script>
	    <script type="text/javascript" src="Measure.js"></script>
	    <script type="text/javascript" src="Clef.js"></script>
	    <script type="text/javascript" src="TimeSignature.js"></script>
	    <script type="text/javascript" src="KeySignature.js"></script>
	    <script type="text/javascript" src="Chord.js"></script>
	    <script type="text/javascript" src="Rest.js"></script>
	    <script type="text/javascript" src="RestElement.js"></script>
	    <script type="text/javascript" src="NoteGroup.js"></script>
	    <script type="text/javascript" src="DotGroup.js"></script>
	    <script type="text/javascript" src="Note.js"></script>
	    <script type="text/javascript" src="Notehead.js"></script>
	    <script type="text/javascript" src="Accidental.js"></script>
	    <script type="text/javascript" src="Dot.js"></script>
	    <script type="text/javascript" src="Articulation.js"></script>
		
		<script type="text/javascript">
            window.onload = function() {
                
                var canvas = document.getElementById("canvas"); //Get the canvas
                var svg = document.getElementById("cursorSvg"); //Get the SVG
                canvas.height = 600;
                svg.height = 600;
                canvas.width = 600;
                svg.width = 600;
                canvas.style.border = "2px solid #000"; //Add a border (for debugging)
                //canvas.style.marginLeft = "20px";
                
                
                // var score = new Renderer.Score('a');
                // var part = new Renderer.Part('b');
                // var voice = new Renderer.Voice('c');
                // var measure = new Renderer.Measure('d');
                // var measure2 = new Renderer.Measure('h');
                var clef = new Renderer.Clef('e','gClef',-1);
                var timeSig = new Renderer.TimeSignature('l',[4],[4]);
                var keySig = new Renderer.KeySignature('m',4);
                // var note = new Renderer.Note('f',1,8);
                // var note2 = new Renderer.Note('g',-1,16);
                // var note3 = new Renderer.Note('i',-2,4);
                // var note4 = new Renderer.Note('j',-1,2);
                // var note5 = new Renderer.Note('k',-1,1);
                // score.add(part);
                // part.add(voice);
                // voice.add(measure);
                // voice.add(measure2);
                // measure.add(clef);
                // measure.add(keySig);
                // measure.add(timeSig);
                // measure.add(note);
                // measure.add(note2);
                // measure2.add(note3);
                // measure2.add(note4);
                // measure2.add(note5);
                
                // var it = new DepthFirstCompositeIterator(score);
                // while(it.hasNext()) {
                //     console.log(it.next().id);
                // }
                
                var score = new Renderer.Score('a');
                var part1 = new Renderer.Part('b','Baritone');
                var part2 = new Renderer.Part('b','Baritone');
                var voice = new Renderer.Voice('c');
                var measure = new Renderer.Measure('d');
                var measure2 = new Renderer.Measure('e');
                var measure3 = new Renderer.Measure('e');
                
                var chord1 = new Renderer.Chord('z',4,0,null);
                var chord2 = new Renderer.Chord('y',2,0,null);
                var chord3 = new Renderer.Chord('y',2,0,null);
                var chord4 = new Renderer.Chord('y',4,0,null);
                var chord5 = new Renderer.Chord('y',4,0,null);
                var chord6 = new Renderer.Chord('y',8,0,null);
                var chord7 = new Renderer.Chord('y',8,0,null);
                var chord8 = new Renderer.Chord('x',1,0,null);
                var chord9 = new Renderer.Chord('x',1,0,null);
                chord1.addNote(new Renderer.Note('i',1,null,chord1));
                chord1.addNote(new Renderer.Note('i',-1,null,chord1));
                chord1.addNote(new Renderer.Note('i',-2,null,chord1));
                chord1.addNote(new Renderer.Note('i',1.5,null,chord1));
                chord2.addNote(new Renderer.Note('i',1,null,chord2));
                chord3.addNote(new Renderer.Note('i',1,null,chord3));
                chord4.addNote(new Renderer.Note('i',1,null,chord4));
                chord5.addNote(new Renderer.Note('i',1,null,chord5));
                chord6.addNote(new Renderer.Note('i',1,null,chord6));
                chord7.addNote(new Renderer.Note('i',1,null,chord7));
                chord8.addNote(new Renderer.Note('i',1,null,chord8));
                chord9.addNote(new Renderer.Note('i',1,null,chord8));
                
                var rest1 = new Renderer.Rest('q',1,0);
                var rest2 = new Renderer.Rest('q',2,2);
                var rest3 = new Renderer.Rest('q',4,1);
                var rest4 = new Renderer.Rest('q',8,0);
                // var rest5 = new Renderer.Rest('q',16,0);
                // var rest6 = new Renderer.Rest('q',32,0);
                // var rest7 = new Renderer.Rest('q',64,0);
                // var rest8 = new Renderer.Rest('q',128,0);
                
                measure.add(clef);
                measure.add(keySig);
                measure.add(timeSig);
                measure.add(chord1);
                measure.add(chord2);
                measure.add(chord3);
                measure.add(chord4);
                measure.add(chord5);
                measure.add(chord6);
                measure.add(chord7);
                //measure.add(rest1);
                //measure.add(rest2);
                //measure.add(rest3);
                //measure.add(rest4);
                // measure.add(rest5);
                // measure.add(rest6);
                // measure.add(rest7);
                // measure.add(rest8);
                //measure2.add(chord8);
                //measure2.add(chord9);
                voice.add(measure);
                voice.add(measure2);
                voice.add(measure3);
                part1.addVoice(voice);
                part2.addVoice(voice);
                
                score.add(part1);
                //score.add(part2)
                
                var sd = new ScoreDisplay(canvas,svg,15,2,6);
                sd.updateAndRender(score);
                
                console.log("Updating articulation.");
                score.getChild(0).voiceGroup.getChild(0).getChild(0).getChild(4).update(2,1,'staccatissimo');
                sd.formatAndRender();
                
                function locateComponent(id) {
                    var cur = sd.scoreComponent;
                    var iter = cur.createBFIterator();
                    while (iter.hasNext()) {
                        cur = iter.next();
                        if (cur.id == id) {
                            return cur;
                        }
                    }
                    console.log('Component with id '+id+' not found. Returning null.');
                    return null;
                }
                
                var left = document.getElementById("left");
                var right = document.getElementById("right");
                var insert = document.getElementById("insert");
                var switchMode = document.getElementById("switchMode");
                var deleteButton = document.getElementById("deleteButton");
                left.addEventListener('click', function(e) {
                    sd.cursor.previous();
                }, false);
                right.addEventListener('click', function(e) {
                    sd.cursor.next();
                }, false);
                insert.addEventListener('click', function(e) {
                    var splice = sd.cursor.curMeasureSplice();
                    var chord = new Renderer.Chord('x',4,0,null);
                    chord.addNote(new Renderer.Note('i',-1,null,chord));
                    var measure = locateComponent(splice.id);
                    measure.addAt(chord,splice.index);
                    sd.formatAndRender();
                }, false);
                switchMode.addEventListener('click',function(e) {
                    sd.cursor.switchModes();
                });
                deleteButton.addEventListener('click',function(e) {
                    var pos = sd.cursor.getCurrentPosition();
                    var measure = sd.scoreComponent.getChild(pos.part).voiceGroup.getChild(pos.voice).getChild(pos.measure);
                    measure.removeAt(pos.measureContents);
                    sd.formatAndRender();
                });
                
                
            };
            
		</script>
		
		<!--<script type="text/javascript" src="vexflow-min.js"></script>-->
	</head>
    <body>
      <button id="left">left</button>
      <button id="right">right</button>
      <button id="insert">insert</button>
      <button id="switchMode">switch</button>
      <button id="deleteButton">delete</button>
      <canvas id="canvas" style="position:absolute;top:40px;left:0px;"></canvas>
      <svg id="cursorSvg" style="position:absolute;top:40px;left:0px;"></svg>
    </body>
</html>